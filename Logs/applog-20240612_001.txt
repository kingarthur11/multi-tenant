2024-06-12 08:02:12.132 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 08:02:12.720 +01:00 [DBG] Hosting starting
2024-06-12 08:02:14.201 +01:00 [ERR] Hosting failed to start
System.IO.IOException: Failed to bind to address http://127.0.0.1:5165: address already in use.
 ---> Microsoft.AspNetCore.Connections.AddressInUseException: Only one usage of each socket address (protocol/network address/port) is normally permitted.
 ---> System.Net.Sockets.SocketException (10048): Only one usage of each socket address (protocol/network address/port) is normally permitted.
   at System.Net.Sockets.Socket.UpdateStatusAfterSocketErrorAndThrowException(SocketError error, Boolean disconnectOnFailure, String callerName)
   at System.Net.Sockets.Socket.DoBind(EndPoint endPointSnapshot, SocketAddress socketAddress)
   at System.Net.Sockets.Socket.Bind(EndPoint localEP)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportOptions.CreateDefaultBoundListenSocket(EndPoint endpoint)
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketConnectionListener.Bind()
   at Microsoft.AspNetCore.Server.Kestrel.Transport.Sockets.SocketTransportFactory.BindAsync(EndPoint endpoint, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Infrastructure.TransportManager.BindAsync(EndPoint endPoint, ConnectionDelegate connectionDelegate, EndpointConfig endpointConfig, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.<>c__DisplayClass28_0`1.<<StartAsync>g__OnBind|0>d.MoveNext()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindEndpointAsync(ListenOptions endpoint, AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.LocalhostListenOptions.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.AddressesStrategy.BindAsync(AddressBindContext context, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.AddressBinder.BindAsync(ListenOptions[] listenOptions, AddressBindContext context, Func`2 useHttps, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.BindAsync(CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Server.Kestrel.Core.KestrelServerImpl.StartAsync[TContext](IHttpApplication`1 application, CancellationToken cancellationToken)
   at Microsoft.AspNetCore.Hosting.GenericWebHostService.StartAsync(CancellationToken cancellationToken)
   at Microsoft.Extensions.Hosting.Internal.Host.<StartAsync>b__15_1(IHostedService service, CancellationToken token)
   at Microsoft.Extensions.Hosting.Internal.Host.ForeachService[T](IEnumerable`1 services, CancellationToken token, Boolean concurrent, Boolean abortOnFirstException, List`1 exceptions, Func`3 operation)
2024-06-12 08:37:10.808 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 08:37:11.026 +01:00 [DBG] Hosting starting
2024-06-12 08:37:11.198 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 08:37:11.206 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 08:37:11.208 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 08:37:11.210 +01:00 [INF] Hosting environment: Development
2024-06-12 08:37:11.212 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 08:37:11.213 +01:00 [DBG] Hosting started
2024-06-12 08:37:55.951 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" accepted.
2024-06-12 08:37:55.969 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" started.
2024-06-12 08:37:56.065 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/product - application/json 37
2024-06-12 08:37:56.081 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 08:37:56.140 +01:00 [DBG] 1 candidate(s) found for the request path '/api/product'
2024-06-12 08:37:56.162 +01:00 [DBG] Endpoint 'MyProject.Controller.ProductsController.Post (MyProject)' with route pattern 'api/product' is valid for the request path '/api/product'
2024-06-12 08:37:56.174 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:37:56.215 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 08:37:56.425 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 08:37:57.185 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 08:37:57.305 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 08:37:57.686 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 08:37:57.736 +01:00 [DBG] Creating DbConnection.
2024-06-12 08:37:57.783 +01:00 [DBG] Created DbConnection. (47ms).
2024-06-12 08:37:57.790 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:58.053 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:58.066 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 08:37:58.081 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (12ms).
2024-06-12 08:37:58.092 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (31ms).
2024-06-12 08:37:58.115 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 08:37:58.251 +01:00 [INF] Executed DbCommand (140ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 08:37:58.339 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:37:58.382 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:58.405 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 139ms reading results.
2024-06-12 08:37:58.418 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:58.591 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (171ms).
2024-06-12 08:37:58.606 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 08:37:58.608 +01:00 [INF] Executing endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:37:58.657 +01:00 [INF] Route matched with {action = "Post", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(MyProject.DTOs.CreateProductRequest) on controller MyProject.Controller.ProductsController (MyProject).
2024-06-12 08:37:58.672 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 08:37:58.674 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 08:37:58.679 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 08:37:58.682 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 08:37:58.685 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 08:37:58.692 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 08:37:58.704 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 08:37:58.722 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 08:37:58.728 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' using the name '' in request data ...
2024-06-12 08:37:58.733 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 08:37:58.766 +01:00 [DBG] Connection id "0HN4AMA9KDKTL", Request id "0HN4AMA9KDKTL:00000001": started reading request body.
2024-06-12 08:37:58.769 +01:00 [DBG] Connection id "0HN4AMA9KDKTL", Request id "0HN4AMA9KDKTL:00000001": done reading request body.
2024-06-12 08:37:58.781 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateProductRequest'
2024-06-12 08:37:58.783 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:37:58.786 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:37:58.788 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 08:37:58.805 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:37:58.882 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 08:37:58.917 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'Product.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:37:58.950 +01:00 [DBG] Context 'AppDbContext' started tracking 'Product' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:37:58.954 +01:00 [INF] Tenant from header context: beta
2024-06-12 08:37:58.958 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 08:37:58.979 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 08:37:58.984 +01:00 [INF] Entity state: Added
2024-06-12 08:37:58.988 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 08:37:58.991 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 08:37:58.994 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 08:37:59.069 +01:00 [DBG] Creating DbConnection.
2024-06-12 08:37:59.071 +01:00 [DBG] Created DbConnection. (1ms).
2024-06-12 08:37:59.072 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:59.075 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:59.080 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 08:37:59.082 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 08:37:59.085 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 08:37:59.087 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 08:37:59.123 +01:00 [ERR] Failed executing DbCommand (34ms) [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 08:37:59.132 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:59.134 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 08:37:59.160 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 08:37:59.181 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 65
2024-06-12 08:37:59.219 +01:00 [INF] Executed action MyProject.Controller.ProductsController.Post (MyProject) in 527.7961ms
2024-06-12 08:37:59.223 +01:00 [INF] Executed endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:37:59.231 +01:00 [ERR] HTTP POST /api/product responded 500 in 623.8011 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 65
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 08:37:59.275 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 65
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 08:37:59.333 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" completed keep alive response.
2024-06-12 08:37:59.337 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 08:37:59.349 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:59.353 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (4ms).
2024-06-12 08:37:59.357 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 08:37:59.362 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:37:59.366 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (4ms).
2024-06-12 08:37:59.370 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/product - 500 null text/plain; charset=utf-8 3310.2418ms
2024-06-12 08:40:10.551 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" disconnecting.
2024-06-12 08:40:10.560 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" stopped.
2024-06-12 08:40:10.565 +01:00 [DBG] Connection id "0HN4AMA9KDKTL" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 08:56:39.169 +01:00 [INF] Application is shutting down...
2024-06-12 08:56:39.171 +01:00 [DBG] Hosting stopping
2024-06-12 08:56:39.240 +01:00 [DBG] Hosting stopped
2024-06-12 08:56:53.838 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 08:56:54.060 +01:00 [DBG] Hosting starting
2024-06-12 08:56:54.479 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 08:56:54.545 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 08:56:54.651 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 08:56:54.717 +01:00 [INF] Hosting environment: Development
2024-06-12 08:56:54.766 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 08:56:54.779 +01:00 [DBG] Hosting started
2024-06-12 08:57:30.024 +01:00 [DBG] Connection id "0HN4AML7H9EEI" accepted.
2024-06-12 08:57:30.027 +01:00 [DBG] Connection id "0HN4AML7H9EEI" started.
2024-06-12 08:57:30.096 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/product - application/json 37
2024-06-12 08:57:30.106 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 08:57:30.133 +01:00 [DBG] 1 candidate(s) found for the request path '/api/product'
2024-06-12 08:57:30.140 +01:00 [DBG] Endpoint 'MyProject.Controller.ProductsController.Post (MyProject)' with route pattern 'api/product' is valid for the request path '/api/product'
2024-06-12 08:57:30.144 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:57:30.164 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 08:57:30.288 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 08:57:31.222 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 08:57:31.329 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 08:57:31.675 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 08:57:31.734 +01:00 [DBG] Creating DbConnection.
2024-06-12 08:57:31.773 +01:00 [DBG] Created DbConnection. (37ms).
2024-06-12 08:57:31.781 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:32.121 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:32.173 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 08:57:32.200 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (19ms).
2024-06-12 08:57:32.211 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (38ms).
2024-06-12 08:57:32.229 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 08:57:32.384 +01:00 [INF] Executed DbCommand (154ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 08:57:32.463 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:57:32.498 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:32.521 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 120ms reading results.
2024-06-12 08:57:32.533 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:32.543 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (12ms).
2024-06-12 08:57:32.549 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 08:57:32.553 +01:00 [INF] Executing endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:57:32.593 +01:00 [INF] Route matched with {action = "Post", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(MyProject.DTOs.CreateProductRequest) on controller MyProject.Controller.ProductsController (MyProject).
2024-06-12 08:57:32.600 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 08:57:32.603 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 08:57:32.607 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 08:57:32.610 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 08:57:32.615 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 08:57:32.621 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 08:57:32.628 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 08:57:32.640 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 08:57:32.644 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' using the name '' in request data ...
2024-06-12 08:57:32.651 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 08:57:32.686 +01:00 [DBG] Connection id "0HN4AML7H9EEI", Request id "0HN4AML7H9EEI:00000001": started reading request body.
2024-06-12 08:57:32.688 +01:00 [DBG] Connection id "0HN4AML7H9EEI", Request id "0HN4AML7H9EEI:00000001": done reading request body.
2024-06-12 08:57:32.702 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateProductRequest'
2024-06-12 08:57:32.704 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:57:32.706 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:57:32.709 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 08:57:32.721 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 08:57:32.833 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 08:57:32.898 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'Product.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:57:32.958 +01:00 [DBG] Context 'AppDbContext' started tracking 'Product' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 08:57:32.964 +01:00 [INF] Tenant from header context: beta
2024-06-12 08:57:32.972 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 08:57:32.998 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 08:57:33.005 +01:00 [INF] Entity state: Added
2024-06-12 08:57:33.009 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 08:57:33.012 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 08:57:33.017 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 08:57:33.127 +01:00 [DBG] Creating DbConnection.
2024-06-12 08:57:33.129 +01:00 [DBG] Created DbConnection. (1ms).
2024-06-12 08:57:33.131 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:33.134 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:33.138 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 08:57:33.140 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 08:57:33.143 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 08:57:33.145 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 08:57:33.177 +01:00 [ERR] Failed executing DbCommand (30ms) [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 08:57:33.189 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:33.192 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 08:57:33.218 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 08:57:33.241 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 66
2024-06-12 08:57:33.283 +01:00 [INF] Executed action MyProject.Controller.ProductsController.Post (MyProject) in 657.0984ms
2024-06-12 08:57:33.287 +01:00 [INF] Executed endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 08:57:33.292 +01:00 [ERR] HTTP POST /api/product responded 500 in 742.6852 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 66
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 08:57:33.326 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 66
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 08:57:33.376 +01:00 [DBG] Connection id "0HN4AML7H9EEI" completed keep alive response.
2024-06-12 08:57:33.386 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 08:57:33.408 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:33.428 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (20ms).
2024-06-12 08:57:33.436 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 08:57:33.439 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 08:57:33.440 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 08:57:33.443 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/product - 500 null text/plain; charset=utf-8 3348.0107ms
2024-06-12 08:59:44.475 +01:00 [DBG] Connection id "0HN4AML7H9EEI" disconnecting.
2024-06-12 08:59:44.629 +01:00 [DBG] Connection id "0HN4AML7H9EEI" stopped.
2024-06-12 08:59:44.649 +01:00 [DBG] Connection id "0HN4AML7H9EEI" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 09:08:20.889 +01:00 [INF] Application is shutting down...
2024-06-12 09:08:20.895 +01:00 [DBG] Hosting stopping
2024-06-12 09:08:20.924 +01:00 [DBG] Hosting stopped
2024-06-12 09:08:32.753 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 09:08:33.008 +01:00 [DBG] Hosting starting
2024-06-12 09:08:33.089 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 09:08:33.092 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 09:08:33.096 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 09:08:33.097 +01:00 [INF] Hosting environment: Development
2024-06-12 09:08:33.099 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 09:08:33.101 +01:00 [DBG] Hosting started
2024-06-12 09:08:38.595 +01:00 [DBG] Connection id "0HN4AMREP9031" accepted.
2024-06-12 09:08:38.597 +01:00 [DBG] Connection id "0HN4AMREP9031" started.
2024-06-12 09:08:38.657 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/product - application/json 37
2024-06-12 09:08:38.673 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 09:08:38.711 +01:00 [DBG] 1 candidate(s) found for the request path '/api/product'
2024-06-12 09:08:38.720 +01:00 [DBG] Endpoint 'MyProject.Controller.ProductsController.Post (MyProject)' with route pattern 'api/product' is valid for the request path '/api/product'
2024-06-12 09:08:38.723 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:08:38.751 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 09:08:39.023 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 09:08:40.207 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:08:40.417 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 09:08:40.791 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 09:08:40.854 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:08:40.893 +01:00 [DBG] Created DbConnection. (37ms).
2024-06-12 09:08:40.902 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.125 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.136 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:08:41.146 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (7ms).
2024-06-12 09:08:41.158 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (23ms).
2024-06-12 09:08:41.177 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:08:41.334 +01:00 [INF] Executed DbCommand (163ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:08:41.415 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:08:41.447 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.461 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 118ms reading results.
2024-06-12 09:08:41.471 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.479 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (7ms).
2024-06-12 09:08:41.485 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 09:08:41.487 +01:00 [INF] Executing endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:08:41.511 +01:00 [INF] Route matched with {action = "Post", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(MyProject.DTOs.CreateProductRequest) on controller MyProject.Controller.ProductsController (MyProject).
2024-06-12 09:08:41.518 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 09:08:41.520 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 09:08:41.524 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 09:08:41.526 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 09:08:41.528 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 09:08:41.535 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:08:41.540 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:08:41.546 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:08:41.553 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' using the name '' in request data ...
2024-06-12 09:08:41.557 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 09:08:41.579 +01:00 [DBG] Connection id "0HN4AMREP9031", Request id "0HN4AMREP9031:00000001": started reading request body.
2024-06-12 09:08:41.583 +01:00 [DBG] Connection id "0HN4AMREP9031", Request id "0HN4AMREP9031:00000001": done reading request body.
2024-06-12 09:08:41.592 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateProductRequest'
2024-06-12 09:08:41.593 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:08:41.595 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:08:41.599 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:08:41.609 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:08:41.683 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:08:41.716 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'Product.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:08:41.750 +01:00 [DBG] Context 'AppDbContext' started tracking 'Product' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:08:41.759 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:08:41.776 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:08:41.779 +01:00 [INF] Tenant from header context: beta
2024-06-12 09:08:41.784 +01:00 [INF] Entity state: Added
2024-06-12 09:08:41.789 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 09:08:41.792 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:08:41.794 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:08:41.862 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:08:41.864 +01:00 [DBG] Created DbConnection. (2ms).
2024-06-12 09:08:41.867 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.870 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.874 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:08:41.876 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 09:08:41.878 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 09:08:41.882 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:08:41.904 +01:00 [ERR] Failed executing DbCommand (22ms) [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:08:41.912 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:41.916 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 09:08:41.938 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 09:08:41.960 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 67
2024-06-12 09:08:42.003 +01:00 [INF] Executed action MyProject.Controller.ProductsController.Post (MyProject) in 463.885ms
2024-06-12 09:08:42.008 +01:00 [INF] Executed endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:08:42.012 +01:00 [ERR] HTTP POST /api/product responded 500 in 527.3153 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 67
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 09:08:42.043 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 67
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 09:08:42.086 +01:00 [DBG] Connection id "0HN4AMREP9031" completed keep alive response.
2024-06-12 09:08:42.093 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 09:08:42.105 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:42.110 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (5ms).
2024-06-12 09:08:42.117 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 09:08:42.120 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:08:42.122 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 09:08:42.126 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/product - 500 null text/plain; charset=utf-8 3471.1767ms
2024-06-12 09:10:52.194 +01:00 [DBG] Connection id "0HN4AMREP9031" disconnecting.
2024-06-12 09:10:52.307 +01:00 [DBG] Connection id "0HN4AMREP9031" stopped.
2024-06-12 09:10:52.315 +01:00 [DBG] Connection id "0HN4AMREP9031" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 09:32:56.004 +01:00 [INF] Application is shutting down...
2024-06-12 09:32:56.011 +01:00 [DBG] Hosting stopping
2024-06-12 09:32:56.029 +01:00 [DBG] Hosting stopped
2024-06-12 09:33:17.580 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 09:33:18.613 +01:00 [DBG] Hosting starting
2024-06-12 09:33:18.751 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 09:33:18.764 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 09:33:18.766 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 09:33:18.768 +01:00 [INF] Hosting environment: Development
2024-06-12 09:33:18.773 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 09:33:18.775 +01:00 [DBG] Hosting started
2024-06-12 09:33:30.010 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" accepted.
2024-06-12 09:33:30.234 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" started.
2024-06-12 09:33:30.332 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/product - application/json 37
2024-06-12 09:33:30.354 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 09:33:30.435 +01:00 [DBG] 1 candidate(s) found for the request path '/api/product'
2024-06-12 09:33:30.446 +01:00 [DBG] Endpoint 'MyProject.Controller.ProductsController.Post (MyProject)' with route pattern 'api/product' is valid for the request path '/api/product'
2024-06-12 09:33:30.451 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:33:30.505 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 09:33:30.781 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 09:33:32.339 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:33:32.501 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 09:33:33.115 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 09:33:33.219 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:33:33.302 +01:00 [DBG] Created DbConnection. (77ms).
2024-06-12 09:33:33.316 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:33.793 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:33.928 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:33:33.947 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (13ms).
2024-06-12 09:33:33.965 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (41ms).
2024-06-12 09:33:34.002 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:33:34.185 +01:00 [INF] Executed DbCommand (192ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:33:34.318 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:33:34.370 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:34.401 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 191ms reading results.
2024-06-12 09:33:34.415 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:34.430 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (14ms).
2024-06-12 09:33:34.437 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 09:33:34.443 +01:00 [INF] Executing endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:33:34.482 +01:00 [INF] Route matched with {action = "Post", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(MyProject.DTOs.CreateProductRequest) on controller MyProject.Controller.ProductsController (MyProject).
2024-06-12 09:33:34.491 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 09:33:34.495 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 09:33:34.500 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 09:33:34.504 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 09:33:34.511 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 09:33:34.518 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:33:34.530 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:33:34.545 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:33:34.553 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' using the name '' in request data ...
2024-06-12 09:33:34.562 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 09:33:34.610 +01:00 [DBG] Connection id "0HN4AN9B8GNHV", Request id "0HN4AN9B8GNHV:00000001": started reading request body.
2024-06-12 09:33:34.613 +01:00 [DBG] Connection id "0HN4AN9B8GNHV", Request id "0HN4AN9B8GNHV:00000001": done reading request body.
2024-06-12 09:33:34.629 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateProductRequest'
2024-06-12 09:33:34.632 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:33:34.635 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:33:34.637 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:33:34.659 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:33:34.776 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:33:34.833 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'Product.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:33:34.883 +01:00 [DBG] Context 'AppDbContext' started tracking 'Product' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:33:34.898 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:33:34.954 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:33:34.997 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 09:33:35.008 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:33:35.015 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:33:35.168 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:33:35.170 +01:00 [DBG] Created DbConnection. (2ms).
2024-06-12 09:33:35.174 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:35.178 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:35.184 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:33:35.186 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-06-12 09:33:35.193 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (8ms).
2024-06-12 09:33:35.196 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:33:35.236 +01:00 [ERR] Failed executing DbCommand (38ms) [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:33:35.249 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:35.252 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 09:33:35.284 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 09:33:35.330 +01:00 [INF] Executed action MyProject.Controller.ProductsController.Post (MyProject) in 811.4342ms
2024-06-12 09:33:35.337 +01:00 [INF] Executed endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:33:35.346 +01:00 [ERR] HTTP POST /api/product responded 500 in 906.4805 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 09:33:35.432 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 09:33:35.507 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" completed keep alive response.
2024-06-12 09:33:35.519 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 09:33:35.592 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:35.598 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (11ms).
2024-06-12 09:33:35.600 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 09:33:35.602 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:33:35.604 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 09:33:35.617 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/product - 500 null text/plain; charset=utf-8 5288.5844ms
2024-06-12 09:35:46.472 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" disconnecting.
2024-06-12 09:35:46.477 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" stopped.
2024-06-12 09:35:46.481 +01:00 [DBG] Connection id "0HN4AN9B8GNHV" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 09:56:04.807 +01:00 [INF] Application is shutting down...
2024-06-12 09:56:04.818 +01:00 [DBG] Hosting stopping
2024-06-12 09:56:04.845 +01:00 [DBG] Hosting stopped
2024-06-12 09:56:21.944 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 09:56:23.416 +01:00 [DBG] Hosting starting
2024-06-12 09:56:23.512 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 09:56:23.514 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 09:56:23.517 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 09:56:23.519 +01:00 [INF] Hosting environment: Development
2024-06-12 09:56:23.521 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 09:56:23.523 +01:00 [DBG] Hosting started
2024-06-12 09:56:36.035 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" accepted.
2024-06-12 09:56:36.040 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" started.
2024-06-12 09:56:36.103 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 09:56:36.120 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 09:56:36.168 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 09:56:36.178 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 09:56:36.182 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:56:36.211 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 09:56:36.428 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 09:56:37.643 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:56:37.752 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 09:56:38.314 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 09:56:38.451 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:56:38.532 +01:00 [DBG] Created DbConnection. (74ms).
2024-06-12 09:56:38.549 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:56:39.016 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:56:39.030 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:56:39.047 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (11ms).
2024-06-12 09:56:39.063 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (33ms).
2024-06-12 09:56:39.117 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:56:39.417 +01:00 [INF] Executed DbCommand (328ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:56:39.597 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:56:39.662 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:56:39.739 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 248ms reading results.
2024-06-12 09:56:39.750 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:56:40.360 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (610ms).
2024-06-12 09:56:40.372 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 09:56:40.378 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:56:40.440 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.Entities.TodoItem) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 09:56:40.447 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 09:56:40.449 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 09:56:40.458 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 09:56:40.461 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 09:56:40.463 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 09:56:40.470 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 09:56:40.481 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 09:56:40.494 +01:00 [DBG] Attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem' ...
2024-06-12 09:56:40.508 +01:00 [DBG] Attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem' using the name '' in request data ...
2024-06-12 09:56:40.513 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 09:56:40.572 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000001": started reading request body.
2024-06-12 09:56:40.579 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000001": done reading request body.
2024-06-12 09:56:40.596 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.Entities.TodoItem'
2024-06-12 09:56:40.598 +01:00 [DBG] Done attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:56:40.600 +01:00 [DBG] Done attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:56:40.607 +01:00 [DBG] Attempting to validate the bound parameter 'todoItem' of type 'MyProject.Entities.TodoItem' ...
2024-06-12 09:56:40.633 +01:00 [DBG] Done attempting to validate the bound parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:56:40.640 +01:00 [DBG] The request has model state errors, returning an error response.
2024-06-12 09:56:40.647 +01:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2024-06-12 09:56:40.654 +01:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-06-12 09:56:40.661 +01:00 [DBG] No information found on request to perform content negotiation.
2024-06-12 09:56:40.664 +01:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2024-06-12 09:56:40.674 +01:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2024-06-12 09:56:40.678 +01:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2024-06-12 09:56:40.765 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 293.5399ms
2024-06-12 09:56:40.776 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:56:40.786 +01:00 [INF] HTTP POST /api/Controller responded 400 in 410.5253 ms
2024-06-12 09:56:40.797 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" completed keep alive response.
2024-06-12 09:56:41.082 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 09:56:41.095 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:56:41.104 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (5ms).
2024-06-12 09:56:41.109 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 400 null application/problem+json; charset=utf-8 5008.0262ms
2024-06-12 09:57:49.075 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/product - application/json 37
2024-06-12 09:57:49.187 +01:00 [DBG] 1 candidate(s) found for the request path '/api/product'
2024-06-12 09:57:49.190 +01:00 [DBG] Endpoint 'MyProject.Controller.ProductsController.Post (MyProject)' with route pattern 'api/product' is valid for the request path '/api/product'
2024-06-12 09:57:49.202 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:57:49.207 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 09:57:49.265 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:57:49.276 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:57:49.279 +01:00 [DBG] Created DbConnection. (2ms).
2024-06-12 09:57:49.283 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:49.286 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:49.288 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:57:49.290 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-06-12 09:57:49.293 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 09:57:49.299 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:57:49.310 +01:00 [INF] Executed DbCommand (10ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:57:49.317 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:57:49.320 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:49.323 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 5ms reading results.
2024-06-12 09:57:49.326 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:49.332 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (5ms).
2024-06-12 09:57:49.335 +01:00 [INF] Executing endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:57:49.350 +01:00 [INF] Route matched with {action = "Post", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Post(MyProject.DTOs.CreateProductRequest) on controller MyProject.Controller.ProductsController (MyProject).
2024-06-12 09:57:49.354 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 09:57:49.356 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 09:57:49.357 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 09:57:49.359 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 09:57:49.366 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 09:57:49.368 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:57:49.372 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.ProductsController (MyProject)
2024-06-12 09:57:49.376 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:57:49.383 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' using the name '' in request data ...
2024-06-12 09:57:49.386 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 09:57:49.402 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000002": started reading request body.
2024-06-12 09:57:49.405 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000002": done reading request body.
2024-06-12 09:57:49.414 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateProductRequest'
2024-06-12 09:57:49.416 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:57:49.419 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:57:49.422 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest' ...
2024-06-12 09:57:49.427 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateProductRequest'.
2024-06-12 09:57:49.678 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:57:49.744 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'Product.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:57:49.809 +01:00 [DBG] Context 'AppDbContext' started tracking 'Product' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:57:49.828 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:57:49.870 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:57:49.880 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 09:57:49.886 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 09:57:49.887 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 09:57:50.056 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:57:50.058 +01:00 [DBG] Created DbConnection. (2ms).
2024-06-12 09:57:50.067 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:50.069 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:50.074 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:57:50.075 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 09:57:50.080 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-06-12 09:57:50.082 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:57:50.117 +01:00 [ERR] Failed executing DbCommand (33ms) [Parameters=[@p0='?', @p1='?' (DbType = Decimal), @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Products" ("Name", "Price", "TenantId")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 09:57:50.151 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:50.157 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (6ms).
2024-06-12 09:57:50.200 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 09:57:50.474 +01:00 [INF] Executed action MyProject.Controller.ProductsController.Post (MyProject) in 1105.8923ms
2024-06-12 09:57:50.481 +01:00 [INF] Executed endpoint 'MyProject.Controller.ProductsController.Post (MyProject)'
2024-06-12 09:57:50.485 +01:00 [ERR] HTTP POST /api/product responded 500 in 1150.1688 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 09:57:50.538 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "Products" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "Products" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: Products
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Repository.ProductService.CreateProduct(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Repository\ProductService.cs:line 42
   at MyProject.Controller.ProductsController.Post(CreateProductRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\ProductsController.cs:line 34
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 09:57:50.591 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" completed keep alive response.
2024-06-12 09:57:50.598 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 09:57:50.601 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:50.604 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 09:57:50.607 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 09:57:50.613 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:57:50.617 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (4ms).
2024-06-12 09:57:50.621 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/product - 500 null text/plain; charset=utf-8 1545.8073ms
2024-06-12 09:58:04.553 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 09:58:04.558 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 09:58:04.560 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 09:58:04.563 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:58:04.568 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 09:58:04.575 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 09:58:04.579 +01:00 [DBG] Creating DbConnection.
2024-06-12 09:58:04.580 +01:00 [DBG] Created DbConnection. (1ms).
2024-06-12 09:58:04.583 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:58:04.585 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:58:04.587 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 09:58:04.589 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 09:58:04.592 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 09:58:04.595 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:58:04.600 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 09:58:04.604 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 09:58:04.606 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:58:04.609 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 5ms reading results.
2024-06-12 09:58:04.612 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:58:04.614 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 09:58:04.620 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:58:04.622 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.Entities.TodoItem) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 09:58:04.625 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 09:58:04.628 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 09:58:04.631 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 09:58:04.635 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 09:58:04.638 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 09:58:04.640 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 09:58:04.643 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 09:58:04.646 +01:00 [DBG] Attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem' ...
2024-06-12 09:58:04.648 +01:00 [DBG] Attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem' using the name '' in request data ...
2024-06-12 09:58:04.651 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 09:58:04.654 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000003": started reading request body.
2024-06-12 09:58:04.656 +01:00 [DBG] Connection id "0HN4ANM8AM5TE", Request id "0HN4ANM8AM5TE:00000003": done reading request body.
2024-06-12 09:58:04.659 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.Entities.TodoItem'
2024-06-12 09:58:04.661 +01:00 [DBG] Done attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:58:04.663 +01:00 [DBG] Done attempting to bind parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:58:04.666 +01:00 [DBG] Attempting to validate the bound parameter 'todoItem' of type 'MyProject.Entities.TodoItem' ...
2024-06-12 09:58:04.669 +01:00 [DBG] Done attempting to validate the bound parameter 'todoItem' of type 'MyProject.Entities.TodoItem'.
2024-06-12 09:58:04.672 +01:00 [DBG] The request has model state errors, returning an error response.
2024-06-12 09:58:04.674 +01:00 [DBG] Request was short circuited at action filter 'Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter'.
2024-06-12 09:58:04.676 +01:00 [DBG] List of registered output formatters, in the following order: ["Microsoft.AspNetCore.Mvc.Formatters.HttpNoContentOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StringOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.StreamOutputFormatter","Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter"]
2024-06-12 09:58:04.679 +01:00 [DBG] No information found on request to perform content negotiation.
2024-06-12 09:58:04.681 +01:00 [DBG] Attempting to select the first output formatter in the output formatters list which supports a content type from the explicitly specified content types '["application/problem+json","application/problem+xml","application/problem+json","application/problem+xml"]'.
2024-06-12 09:58:04.687 +01:00 [DBG] Selected output formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonOutputFormatter' and content type 'application/problem+json' to write the response.
2024-06-12 09:58:04.690 +01:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2024-06-12 09:58:04.694 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 53.226ms
2024-06-12 09:58:04.696 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 09:58:04.699 +01:00 [INF] HTTP POST /api/Controller responded 400 in 79.4643 ms
2024-06-12 09:58:04.704 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" completed keep alive response.
2024-06-12 09:58:04.707 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 09:58:04.710 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 09:58:04.713 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 09:58:04.724 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 400 null application/problem+json; charset=utf-8 171.2696ms
2024-06-12 10:00:15.361 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" disconnecting.
2024-06-12 10:00:15.365 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" stopped.
2024-06-12 10:00:15.370 +01:00 [DBG] Connection id "0HN4ANM8AM5TE" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 10:04:43.150 +01:00 [INF] Application is shutting down...
2024-06-12 10:04:43.153 +01:00 [DBG] Hosting stopping
2024-06-12 10:04:43.234 +01:00 [DBG] Hosting stopped
2024-06-12 10:04:59.071 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 10:05:01.574 +01:00 [DBG] Hosting starting
2024-06-12 10:05:01.822 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 10:05:02.051 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 10:05:02.185 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 10:05:02.360 +01:00 [INF] Hosting environment: Development
2024-06-12 10:05:02.492 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 10:05:02.494 +01:00 [DBG] Hosting started
2024-06-12 10:05:10.691 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" accepted.
2024-06-12 10:05:10.698 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" started.
2024-06-12 10:05:10.781 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 10:05:10.801 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 10:05:10.856 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 10:05:10.867 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 10:05:10.872 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:05:10.909 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 10:05:11.186 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 10:05:13.290 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:05:13.548 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 10:05:14.142 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 10:05:14.249 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:05:14.327 +01:00 [DBG] Created DbConnection. (77ms).
2024-06-12 10:05:14.340 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:14.760 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:14.776 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:05:14.798 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (13ms).
2024-06-12 10:05:14.811 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (36ms).
2024-06-12 10:05:14.844 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:05:15.034 +01:00 [INF] Executed DbCommand (185ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:05:15.261 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:05:15.361 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:15.392 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 335ms reading results.
2024-06-12 10:05:15.407 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:15.423 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (15ms).
2024-06-12 10:05:15.433 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 10:05:15.724 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:05:15.956 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.DTOs.CreateTodoRequest) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 10:05:15.974 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 10:05:15.976 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 10:05:16.010 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 10:05:16.039 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 10:05:16.041 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 10:05:16.049 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:05:16.153 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:05:16.202 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:05:16.231 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' using the name '' in request data ...
2024-06-12 10:05:16.237 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 10:05:16.284 +01:00 [DBG] Connection id "0HN4ANR1MQJAI", Request id "0HN4ANR1MQJAI:00000001": started reading request body.
2024-06-12 10:05:16.287 +01:00 [DBG] Connection id "0HN4ANR1MQJAI", Request id "0HN4ANR1MQJAI:00000001": done reading request body.
2024-06-12 10:05:16.304 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateTodoRequest'
2024-06-12 10:05:16.305 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:05:16.307 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:05:16.504 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:05:16.531 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:05:16.685 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:05:16.743 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'TodoItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:05:16.814 +01:00 [DBG] Context 'AppDbContext' started tracking 'TodoItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:05:16.831 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:05:16.865 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:05:16.876 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 10:05:16.885 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:05:16.887 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:05:17.076 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:05:17.083 +01:00 [DBG] Created DbConnection. (6ms).
2024-06-12 10:05:17.084 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:17.087 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:17.092 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:05:17.097 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (5ms).
2024-06-12 10:05:17.099 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (6ms).
2024-06-12 10:05:17.101 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:05:17.124 +01:00 [ERR] Failed executing DbCommand (21ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:05:17.138 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:17.140 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 10:05:17.176 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 10:05:17.231 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 1179.8306ms
2024-06-12 10:05:17.239 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:05:17.248 +01:00 [ERR] HTTP POST /api/Controller responded 500 in 1810.7278 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 10:05:17.375 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 58
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 10:05:17.449 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" completed keep alive response.
2024-06-12 10:05:17.457 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 10:05:17.484 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:17.490 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (6ms).
2024-06-12 10:05:17.495 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 10:05:17.504 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:05:17.506 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 10:05:17.512 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 500 null text/plain; charset=utf-8 6731.7266ms
2024-06-12 10:07:28.284 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" disconnecting.
2024-06-12 10:07:28.290 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" stopped.
2024-06-12 10:07:28.296 +01:00 [DBG] Connection id "0HN4ANR1MQJAI" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 10:18:41.725 +01:00 [INF] Application is shutting down...
2024-06-12 10:18:41.728 +01:00 [DBG] Hosting stopping
2024-06-12 10:18:41.761 +01:00 [DBG] Hosting stopped
2024-06-12 10:18:59.722 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 10:18:59.965 +01:00 [DBG] Hosting starting
2024-06-12 10:19:00.411 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 10:19:00.515 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 10:19:00.522 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 10:19:00.525 +01:00 [INF] Hosting environment: Development
2024-06-12 10:19:00.528 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 10:19:00.531 +01:00 [DBG] Hosting started
2024-06-12 10:19:12.754 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" accepted.
2024-06-12 10:19:12.767 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" started.
2024-06-12 10:19:12.948 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 10:19:13.238 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 10:19:13.321 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 10:19:13.338 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 10:19:13.350 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:19:13.396 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 10:19:13.676 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 10:19:15.214 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:19:15.305 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 10:19:15.916 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 10:19:16.027 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:19:16.078 +01:00 [DBG] Created DbConnection. (47ms).
2024-06-12 10:19:16.085 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:16.415 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:16.424 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:19:16.436 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (8ms).
2024-06-12 10:19:16.447 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (25ms).
2024-06-12 10:19:16.465 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:19:16.601 +01:00 [INF] Executed DbCommand (133ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:19:16.707 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:19:16.744 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:16.766 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 150ms reading results.
2024-06-12 10:19:16.780 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:16.792 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (12ms).
2024-06-12 10:19:16.800 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 10:19:16.803 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:19:16.842 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.DTOs.CreateTodoRequest) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 10:19:16.850 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 10:19:16.853 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 10:19:16.860 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 10:19:16.864 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 10:19:16.868 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 10:19:16.876 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:19:16.885 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:19:16.898 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:19:16.907 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' using the name '' in request data ...
2024-06-12 10:19:16.913 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 10:19:16.963 +01:00 [DBG] Connection id "0HN4AO2SLBO4E", Request id "0HN4AO2SLBO4E:00000001": started reading request body.
2024-06-12 10:19:16.966 +01:00 [DBG] Connection id "0HN4AO2SLBO4E", Request id "0HN4AO2SLBO4E:00000001": done reading request body.
2024-06-12 10:19:16.982 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateTodoRequest'
2024-06-12 10:19:16.985 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:19:16.991 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:19:16.993 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:19:17.015 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:19:17.167 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:19:17.232 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'TodoItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:19:17.299 +01:00 [DBG] Context 'AppDbContext' started tracking 'TodoItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:19:17.315 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:19:17.346 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:19:17.352 +01:00 [INF] Tenant from header context: beta
2024-06-12 10:19:17.367 +01:00 [INF] Entity state: Added
2024-06-12 10:19:17.377 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 10:19:17.382 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:19:17.383 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:19:17.662 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:19:17.664 +01:00 [DBG] Created DbConnection. (1ms).
2024-06-12 10:19:17.667 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:17.674 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:17.682 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:19:17.685 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-06-12 10:19:17.690 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (7ms).
2024-06-12 10:19:17.694 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:19:17.723 +01:00 [ERR] Failed executing DbCommand (26ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:19:17.733 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:17.735 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 10:19:17.778 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 10:19:17.807 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
2024-06-12 10:19:17.978 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 1090.344ms
2024-06-12 10:19:18.734 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:19:18.945 +01:00 [ERR] HTTP POST /api/Controller responded 500 in 2142.8408 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 10:19:19.044 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 10:19:19.115 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" completed keep alive response.
2024-06-12 10:19:19.127 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 10:19:19.142 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:19.149 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (7ms).
2024-06-12 10:19:19.155 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 10:19:19.158 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:19:19.161 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 10:19:19.167 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 500 null text/plain; charset=utf-8 6222.0428ms
2024-06-12 10:21:29.941 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" disconnecting.
2024-06-12 10:21:29.946 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" stopped.
2024-06-12 10:21:29.951 +01:00 [DBG] Connection id "0HN4AO2SLBO4E" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 10:35:38.035 +01:00 [INF] Application is shutting down...
2024-06-12 10:35:38.039 +01:00 [DBG] Hosting stopping
2024-06-12 10:35:38.056 +01:00 [DBG] Hosting stopped
2024-06-12 10:35:48.713 +01:00 [DBG] Registered model binder providers, in the following order: ["Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BinderTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ServicesModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.BodyModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.HeaderModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FloatingPointTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.EnumTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DateTimeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.SimpleTypeModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.TryParseModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CancellationTokenModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ByteArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormFileModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.FormCollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.KeyValuePairModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.DictionaryModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ArrayModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.CollectionModelBinderProvider","Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexObjectModelBinderProvider"]
2024-06-12 10:35:49.219 +01:00 [DBG] Hosting starting
2024-06-12 10:35:49.348 +01:00 [INF] Now listening on: http://localhost:5165
2024-06-12 10:35:49.537 +01:00 [DBG] Loaded hosting startup assembly MyProject
2024-06-12 10:35:49.799 +01:00 [INF] Application started. Press Ctrl+C to shut down.
2024-06-12 10:35:49.917 +01:00 [INF] Hosting environment: Development
2024-06-12 10:35:50.204 +01:00 [INF] Content root path: C:\Users\ARthur\Desktop\projects\personal\MyProject
2024-06-12 10:35:50.222 +01:00 [DBG] Hosting started
2024-06-12 10:36:10.341 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" accepted.
2024-06-12 10:36:10.346 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" started.
2024-06-12 10:36:10.421 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 10:36:10.442 +01:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2024-06-12 10:36:10.498 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 10:36:10.508 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 10:36:10.515 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:36:10.550 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 10:36:10.799 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 10:36:12.451 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:36:12.700 +01:00 [DBG] Compiling query expression: 
'DbSet<Tenant>()
    .Where(x => x.Id == __tenant_0)
    .FirstOrDefault()'
2024-06-12 10:36:13.165 +01:00 [DBG] Generated query execution expression: 
'queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<Tenant>(
    asyncEnumerable: new SingleQueryingEnumerable<Tenant>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache.QueryExpression(
            Projection Mapping:
                EmptyProjectionMember -> Dictionary<IProperty, int> { [Property: Tenant.Id (string) Required PK AfterSave:Throw, 0], [Property: Tenant.Name (string) Required, 1] }
            SELECT TOP(1) t.Id, t.Name
            FROM Tenants AS t
            WHERE t.Id == @__tenant_0), 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator, Tenant>, 
        MyProject.Data.TenantDbContext, 
        False, 
        False, 
        True
    ), 
    cancellationToken: queryContext.CancellationToken)'
2024-06-12 10:36:13.254 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:36:13.331 +01:00 [DBG] Created DbConnection. (71ms).
2024-06-12 10:36:13.345 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:13.795 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:13.834 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:36:13.851 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (9ms).
2024-06-12 10:36:13.864 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (32ms).
2024-06-12 10:36:13.887 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:36:14.013 +01:00 [INF] Executed DbCommand (132ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:36:14.096 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:36:14.137 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:14.164 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 131ms reading results.
2024-06-12 10:36:14.175 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:14.184 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (10ms).
2024-06-12 10:36:14.193 +01:00 [WRN] Failed to determine the https port for redirect.
2024-06-12 10:36:14.198 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:36:14.238 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.DTOs.CreateTodoRequest) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 10:36:14.246 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 10:36:14.250 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 10:36:14.255 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 10:36:14.261 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 10:36:14.264 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 10:36:14.271 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:36:14.283 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:36:14.297 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:36:14.305 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' using the name '' in request data ...
2024-06-12 10:36:14.313 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 10:36:14.354 +01:00 [DBG] Connection id "0HN4AOCBTQJOM", Request id "0HN4AOCBTQJOM:00000001": started reading request body.
2024-06-12 10:36:14.357 +01:00 [DBG] Connection id "0HN4AOCBTQJOM", Request id "0HN4AOCBTQJOM:00000001": done reading request body.
2024-06-12 10:36:14.373 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateTodoRequest'
2024-06-12 10:36:14.380 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:36:14.383 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:36:14.385 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:36:14.398 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:36:14.488 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:36:14.546 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'TodoItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:36:14.648 +01:00 [DBG] Context 'AppDbContext' started tracking 'TodoItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:36:14.669 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:36:14.728 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:36:14.780 +01:00 [INF] Tenant from header context: beta
2024-06-12 10:36:14.789 +01:00 [INF] Entity state: Added
2024-06-12 10:36:14.803 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 10:36:14.816 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:36:15.098 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:36:15.269 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:36:15.271 +01:00 [DBG] Created DbConnection. (1ms).
2024-06-12 10:36:15.273 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:15.278 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:15.283 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:36:15.285 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (2ms).
2024-06-12 10:36:15.287 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (4ms).
2024-06-12 10:36:15.290 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:36:15.311 +01:00 [ERR] Failed executing DbCommand (19ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:36:15.321 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:15.328 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (7ms).
2024-06-12 10:36:15.363 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 10:36:15.396 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
2024-06-12 10:36:15.435 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 1162.811ms
2024-06-12 10:36:15.444 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:36:15.450 +01:00 [ERR] HTTP POST /api/Controller responded 500 in 1257.4844 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 10:36:15.498 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 10:36:15.552 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" completed keep alive response.
2024-06-12 10:36:15.562 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 10:36:15.576 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:15.588 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (13ms).
2024-06-12 10:36:15.596 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 10:36:15.602 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:36:15.604 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 10:36:15.611 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 500 null text/plain; charset=utf-8 5189.4262ms
2024-06-12 10:38:26.661 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" disconnecting.
2024-06-12 10:38:26.674 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" stopped.
2024-06-12 10:38:26.678 +01:00 [DBG] Connection id "0HN4AOCBTQJOM" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 10:38:35.893 +01:00 [DBG] Connection id "0HN4AOCBTQJON" accepted.
2024-06-12 10:38:35.896 +01:00 [DBG] Connection id "0HN4AOCBTQJON" started.
2024-06-12 10:38:35.901 +01:00 [INF] Request starting HTTP/1.1 POST http://localhost:5165/api/Controller - application/json 43
2024-06-12 10:38:35.908 +01:00 [DBG] 1 candidate(s) found for the request path '/api/Controller'
2024-06-12 10:38:35.910 +01:00 [DBG] Endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)' with route pattern 'api/Controller' is valid for the request path '/api/Controller'
2024-06-12 10:38:35.914 +01:00 [DBG] Request matched endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:38:35.919 +01:00 [DBG] Static files was skipped as the request already matched an endpoint.
2024-06-12 10:38:36.002 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'TenantDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:38:36.012 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:38:36.015 +01:00 [DBG] Created DbConnection. (2ms).
2024-06-12 10:38:36.016 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.018 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.021 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:38:36.022 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 10:38:36.024 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-06-12 10:38:36.028 +01:00 [DBG] Executing DbCommand [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:38:36.033 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[@__tenant_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT t."Id", t."Name"
FROM "Tenants" AS t
WHERE t."Id" = @__tenant_0
LIMIT 1
2024-06-12 10:38:36.037 +01:00 [DBG] Context 'TenantDbContext' started tracking 'Tenant' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:38:36.038 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.040 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 4ms reading results.
2024-06-12 10:38:36.045 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.047 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 10:38:36.050 +01:00 [INF] Executing endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:38:36.052 +01:00 [INF] Route matched with {action = "PostTodoItem", controller = "TodoItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[MyProject.Entities.TodoItem]] PostTodoItem(MyProject.DTOs.CreateTodoRequest) on controller MyProject.Controller.TodoItemController (MyProject).
2024-06-12 10:38:36.055 +01:00 [DBG] Execution plan of authorization filters (in the following order): ["None"]
2024-06-12 10:38:36.057 +01:00 [DBG] Execution plan of resource filters (in the following order): ["None"]
2024-06-12 10:38:36.061 +01:00 [DBG] Execution plan of action filters (in the following order): ["Microsoft.AspNetCore.Mvc.ModelBinding.UnsupportedContentTypeFilter (Order: -3000)","Microsoft.AspNetCore.Mvc.Infrastructure.ModelStateInvalidFilter (Order: -2000)"]
2024-06-12 10:38:36.065 +01:00 [DBG] Execution plan of exception filters (in the following order): ["None"]
2024-06-12 10:38:36.067 +01:00 [DBG] Execution plan of result filters (in the following order): ["Microsoft.AspNetCore.Mvc.Infrastructure.ClientErrorResultFilter (Order: -2000)"]
2024-06-12 10:38:36.069 +01:00 [DBG] Executing controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:38:36.072 +01:00 [DBG] Executed controller factory for controller MyProject.Controller.TodoItemController (MyProject)
2024-06-12 10:38:36.074 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:38:36.079 +01:00 [DBG] Attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' using the name '' in request data ...
2024-06-12 10:38:36.081 +01:00 [DBG] Selected input formatter 'Microsoft.AspNetCore.Mvc.Formatters.SystemTextJsonInputFormatter' for content type 'application/json'.
2024-06-12 10:38:36.084 +01:00 [DBG] Connection id "0HN4AOCBTQJON", Request id "0HN4AOCBTQJON:00000001": started reading request body.
2024-06-12 10:38:36.086 +01:00 [DBG] Connection id "0HN4AOCBTQJON", Request id "0HN4AOCBTQJON:00000001": done reading request body.
2024-06-12 10:38:36.087 +01:00 [DBG] JSON input formatter succeeded, deserializing to type 'MyProject.DTOs.CreateTodoRequest'
2024-06-12 10:38:36.089 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:38:36.090 +01:00 [DBG] Done attempting to bind parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:38:36.094 +01:00 [DBG] Attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest' ...
2024-06-12 10:38:36.097 +01:00 [DBG] Done attempting to validate the bound parameter 'request' of type 'MyProject.DTOs.CreateTodoRequest'.
2024-06-12 10:38:36.100 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 10:38:36.104 +01:00 [DBG] 'AppDbContext' generated a temporary value for the property 'TodoItem.Id'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:38:36.106 +01:00 [DBG] Context 'AppDbContext' started tracking 'TodoItem' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2024-06-12 10:38:36.109 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:38:36.111 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:38:36.113 +01:00 [INF] Tenant from header context: beta
2024-06-12 10:38:36.114 +01:00 [INF] Entity state: Added
2024-06-12 10:38:36.116 +01:00 [DBG] SaveChanges starting for 'AppDbContext'.
2024-06-12 10:38:36.118 +01:00 [DBG] DetectChanges starting for 'AppDbContext'.
2024-06-12 10:38:36.120 +01:00 [DBG] DetectChanges completed for 'AppDbContext'.
2024-06-12 10:38:36.123 +01:00 [DBG] Creating DbConnection.
2024-06-12 10:38:36.127 +01:00 [DBG] Created DbConnection. (3ms).
2024-06-12 10:38:36.129 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.131 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.133 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 10:38:36.135 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 10:38:36.137 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (3ms).
2024-06-12 10:38:36.139 +01:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:38:36.146 +01:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "TodoItems" ("IsCompleted", "TenantId", "Title")
VALUES (@p0, @p1, @p2)
RETURNING "Id";
2024-06-12 10:38:36.150 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.153 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 10:38:36.160 +01:00 [ERR] An exception occurred in the database while saving changes for context type 'MyProject.Data.AppDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2024-06-12 10:38:36.184 +01:00 [ERR] Error saving changes
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
2024-06-12 10:38:36.206 +01:00 [INF] Executed action MyProject.Controller.TodoItemController.PostTodoItem (MyProject) in 136.7977ms
2024-06-12 10:38:36.210 +01:00 [INF] Executed endpoint 'MyProject.Controller.TodoItemController.PostTodoItem (MyProject)'
2024-06-12 10:38:36.212 +01:00 [ERR] HTTP POST /api/Controller responded 500 in 161.7603 ms
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
2024-06-12 10:38:36.239 +01:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Npgsql.PostgresException (0x80004005): 23502: null value in column "TenantId" of relation "TodoItems" violates not-null constraint

DETAIL: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
   at Npgsql.Internal.NpgsqlConnector.ReadMessageLong(Boolean async, DataRowLoadingMode dataRowLoadingMode, Boolean readingNotifications, Boolean isReadingPrependedMessage)
   at System.Runtime.CompilerServices.PoolingAsyncValueTaskMethodBuilder`1.StateMachineBox`1.System.Threading.Tasks.Sources.IValueTaskSource<TResult>.GetResult(Int16 token)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlDataReader.NextResult(Boolean async, Boolean isConsuming, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteReader(Boolean async, CommandBehavior behavior, CancellationToken cancellationToken)
   at Npgsql.NpgsqlCommand.ExecuteDbDataReaderAsync(CommandBehavior behavior, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
  Exception data:
    Severity: ERROR
    SqlState: 23502
    MessageText: null value in column "TenantId" of relation "TodoItems" violates not-null constraint
    Detail: Detail redacted as it may contain sensitive data. Specify 'Include Error Detail' in the connection string to include this information.
    SchemaName: public
    TableName: TodoItems
    ColumnName: TenantId
    File: execMain.c
    Line: 1974
    Routine: ExecConstraints
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Npgsql.EntityFrameworkCore.PostgreSQL.Storage.Internal.NpgsqlExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at MyProject.Data.AppDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Data\AppDbContext.cs:line 97
   at MyProject.Controller.TodoItemController.PostTodoItem(CreateTodoRequest request) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Controller\TodoItemController.cs:line 49
   at lambda_method23(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Serilog.AspNetCore.RequestLoggingMiddleware.Invoke(HttpContext httpContext)
   at MyProject.Middleware.TenantResolver.InvokeAsync(HttpContext context, ICurrentTenantService currentTenantService) in C:\Users\ARthur\Desktop\projects\personal\MyProject\Middleware\TenantResolver.cs:line 28
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2024-06-12 10:38:36.277 +01:00 [DBG] Connection id "0HN4AOCBTQJON" completed keep alive response.
2024-06-12 10:38:36.280 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 10:38:36.284 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.286 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 10:38:36.289 +01:00 [DBG] 'TenantDbContext' disposed.
2024-06-12 10:38:36.290 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 10:38:36.296 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (5ms).
2024-06-12 10:38:36.299 +01:00 [INF] Request finished HTTP/1.1 POST http://localhost:5165/api/Controller - 500 null text/plain; charset=utf-8 398.3335ms
2024-06-12 10:40:47.779 +01:00 [DBG] Connection id "0HN4AOCBTQJON" disconnecting.
2024-06-12 10:40:47.787 +01:00 [DBG] Connection id "0HN4AOCBTQJON" stopped.
2024-06-12 10:40:47.793 +01:00 [DBG] Connection id "0HN4AOCBTQJON" sending FIN because: "The Socket transport's send loop completed gracefully."
2024-06-12 18:01:12.975 +01:00 [DBG] An 'IServiceProvider' was created for internal use by Entity Framework.
2024-06-12 18:01:15.831 +01:00 [DBG] Entity Framework Core 8.0.6 initialized 'AppDbContext' using provider 'Npgsql.EntityFrameworkCore.PostgreSQL:8.0.4+51faf6e9c9c7ef99c3e98d98a96adb8fa8ae4553' with options: None
2024-06-12 18:01:16.022 +01:00 [DBG] Creating DbConnection.
2024-06-12 18:01:16.100 +01:00 [DBG] Created DbConnection. (76ms).
2024-06-12 18:01:16.123 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:17.155 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:18.056 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:18.090 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (26ms).
2024-06-12 18:01:18.656 +01:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2024-06-12 18:01:18.674 +01:00 [DBG] Created DbCommand for 'ExecuteScalar' (15ms).
2024-06-12 18:01:18.693 +01:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (43ms).
2024-06-12 18:01:18.722 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:18.960 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:18.985 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:19.235 +01:00 [INF] Executed DbCommand (220ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:21.020 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:22.535 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1513ms).
2024-06-12 18:01:22.773 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:22.878 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:23.369 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 18:01:24.005 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (636ms).
2024-06-12 18:01:24.102 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (733ms).
2024-06-12 18:01:24.111 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-06-12 18:01:24.136 +01:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-06-12 18:01:24.166 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:24.242 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 91ms reading results.
2024-06-12 18:01:25.116 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:25.865 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (749ms).
2024-06-12 18:01:26.019 +01:00 [DBG] Migrating using database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.317 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.472 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.514 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.535 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (21ms).
2024-06-12 18:01:26.555 +01:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2024-06-12 18:01:26.556 +01:00 [DBG] Created DbCommand for 'ExecuteScalar' (1ms).
2024-06-12 18:01:26.559 +01:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (3ms).
2024-06-12 18:01:26.562 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.564 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.568 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:26.573 +01:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:26.577 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.579 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 18:01:26.584 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.729 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.735 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.738 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (3ms).
2024-06-12 18:01:26.784 +01:00 [DBG] Creating DbCommand for 'ExecuteScalar'.
2024-06-12 18:01:26.809 +01:00 [DBG] Created DbCommand for 'ExecuteScalar' (24ms).
2024-06-12 18:01:26.814 +01:00 [DBG] Initialized DbCommand for 'ExecuteScalar' (30ms).
2024-06-12 18:01:26.819 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.825 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.827 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:26.831 +01:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT EXISTS (
    SELECT 1 FROM pg_catalog.pg_class c
    JOIN pg_catalog.pg_namespace n ON n.oid=c.relnamespace
    WHERE n.nspname='public' AND
          c.relname='__EFMigrationsHistory'
)
2024-06-12 18:01:26.836 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.837 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (1ms).
2024-06-12 18:01:26.846 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.847 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.849 +01:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2024-06-12 18:01:26.851 +01:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2024-06-12 18:01:26.871 +01:00 [DBG] Initialized DbCommand for 'ExecuteReader' (21ms).
2024-06-12 18:01:26.886 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-06-12 18:01:26.911 +01:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2024-06-12 18:01:26.915 +01:00 [DBG] Closing data reader to 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.918 +01:00 [DBG] A data reader for 'userservice_db' on server 'tcp://localhost:5432' is being disposed after spending 3ms reading results.
2024-06-12 18:01:26.924 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:26.926 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 18:01:26.963 +01:00 [INF] Applying migration '20240611193129_InitialCreate'.
2024-06-12 18:01:27.092 +01:00 [DBG] Opening connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:27.099 +01:00 [DBG] Opened connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:27.103 +01:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2024-06-12 18:01:27.122 +01:00 [DBG] Began transaction with isolation level 'ReadCommitted'.
2024-06-12 18:01:27.128 +01:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2024-06-12 18:01:27.131 +01:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (2ms).
2024-06-12 18:01:27.136 +01:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (7ms).
2024-06-12 18:01:27.139 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Products" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Price" numeric NOT NULL,
    "TenantId" text NOT NULL,
    CONSTRAINT "PK_Products" PRIMARY KEY ("Id")
);
2024-06-12 18:01:27.179 +01:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Products" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Price" numeric NOT NULL,
    "TenantId" text NOT NULL,
    CONSTRAINT "PK_Products" PRIMARY KEY ("Id")
);
2024-06-12 18:01:27.184 +01:00 [DBG] Creating DbCommand for 'ExecuteNonQuery'.
2024-06-12 18:01:27.186 +01:00 [DBG] Created DbCommand for 'ExecuteNonQuery' (1ms).
2024-06-12 18:01:27.189 +01:00 [DBG] Initialized DbCommand for 'ExecuteNonQuery' (4ms).
2024-06-12 18:01:27.191 +01:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Tenants" (
    "Id" text NOT NULL,
    "Name" text NOT NULL,
    CONSTRAINT "PK_Tenants" PRIMARY KEY ("Id")
);
2024-06-12 18:01:27.214 +01:00 [ERR] Failed executing DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Tenants" (
    "Id" text NOT NULL,
    "Name" text NOT NULL,
    CONSTRAINT "PK_Tenants" PRIMARY KEY ("Id")
);
2024-06-12 18:01:27.232 +01:00 [DBG] Disposing transaction.
2024-06-12 18:01:27.234 +01:00 [DBG] Closing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:27.236 +01:00 [DBG] Closed connection to database 'userservice_db' on server 'tcp://localhost:5432' (2ms).
2024-06-12 18:01:27.246 +01:00 [DBG] 'AppDbContext' disposed.
2024-06-12 18:01:27.252 +01:00 [DBG] Disposing connection to database 'userservice_db' on server 'tcp://localhost:5432'.
2024-06-12 18:01:27.256 +01:00 [DBG] Disposed connection to database 'userservice_db' on server 'tcp://localhost:5432' (4ms).
